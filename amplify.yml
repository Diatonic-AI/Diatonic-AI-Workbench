version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Node.js version management
        - echo "ðŸ”§ Starting pre-build phase for React+Vite+shadcn+Tailwind app"
        - echo "ðŸ“¦ Node version:" && node --version
        - echo "ðŸ“¦ npm version:" && npm --version
        
        # Install dependencies
        - echo "ðŸ“¥ Installing dependencies..."
        - npm ci --production=false
        
        # Update browserslist database for optimal compilation
        - echo "ðŸŒ Updating browserslist..."
        - npm run update-browserslist || npx update-browserslist-db@latest
        
    build:
      commands:
        - echo "ðŸ—ï¸ Starting build phase for production..."
        
        # Clean any previous builds
        - npm run clean || rm -rf dist node_modules/.vite
        
        # Build the application with production optimizations
        - echo "ðŸ”¨ Building React+Vite+Tailwind app..."
        - npm run build
        
        # Verify build output
        - echo "ðŸ“‹ Build completed. Contents of dist/:"
        - ls -la dist/
        
        # Create _redirects file for React Router SPA support
        - echo "ðŸŒ Creating _redirects for SPA routing..."
        - echo "/* /index.html 200" > dist/_redirects
        
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .npm/**/*
