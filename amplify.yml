version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Set Node.js version
        - echo "Setting Node.js to version 18.20.0"
        - nvm install 18.20.0
        - nvm use 18.20.0
        - node --version
        - npm --version
        
        # Update browserslist database for optimal compilation
        - echo "Updating browserslist database..."
        - npx browserslist@latest --update-db
        
        # Install dependencies
        - echo "Installing dependencies..."
        - npm ci --prefer-offline --no-audit
        
    build:
      commands:
        # Build the application
        - echo "Building the application..."
        - npm run build
        
        # Verify build output
        - echo "Build verification..."
        - ls -la dist/
        - echo "Build completed successfully"
        
        # Create _redirects file for React Router SPA support
        - echo "/* /index.html 200" > dist/_redirects
        
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - ~/.npm/**/*
